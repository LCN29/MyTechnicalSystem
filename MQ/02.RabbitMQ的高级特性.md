# 2 RabbitMQ 的高级特性

## 2.1 消息的百分百投递

### 2.1.1 生产端的可靠性投递

大体的流程
> 1. 发送端消息的成功发出
> 2. MQ 节点 (Broker 成功收到消息
> 3. 发送端收到 MQ 节点的确认应答
> 4. 完善的消息补偿机制

#### 2.1.2 常用的解决方案

**方案一**  

消息落库, 对消息状态 (未发送, 发送中, 发送成功等) 进行打标。  

后台定时任务之类的对库中未成功的消息进行处理。



> 1. 将消息先落库, 默认状态为 0
> 2. 将消息发送到 MQ Broker
> 3. 监听到 MQ Broker 的 confirm, 更新消息状态为 1

状态长时间为失败，抽取等操作
定时器设置重试次数






**方案二**  
消息延迟投递, 做第二次确认, 回调检查。




