# 3 RabbitMQ 高可用


## 3.1 RabbitMQ集群架构模式

### 3.1.1 主备模式

也叫做 Warren 模式。一般在并发和数据量不高的情况下, 这种模型非常好用且简单。   
主节点提供读写, 从节点不提供任何读写, 只做主节点的备用。从节点主要用于在主节点宕机后, 从节点可以升级为主节点, 并且数据不丢失。  


HaProxy 的部分配置

```
# 监听的 RabbitMQ 的别名
listen rabbitmq_cluster

# 绑定的地址
bind 0.0.0.0:5672

# 配置为 TCP 模式
mode tcp

# 简单轮询
balance roundrobin

# 主节点 inter 5000 每隔 5000 毫秒对节点做一次健康检查, rise 2 2 次正确证明服务可用, fall 2 2 次失败证明服务器不可用
server rabbitmq_1 192.168.0.1:5672 check inter 5000 rise 2 fall 2

# 备用节点
server rabbitmq_2 192.168.0.2:5672 backup check inter 5000 rise 2 fall 2
```

### 3.1.2 远程模式
也叫做 Shove 模式。 一直双活的模式, 把消息进行不同数据中心的复制, 多个 MQ 集群互联。

启用 2 个插件 `amqp_client` 和 `rabbitmq_shovel`