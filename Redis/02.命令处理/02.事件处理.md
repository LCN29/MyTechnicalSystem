# 2 事件处理


Redis 服务器是典型的事件驱动程序，而事件又分为文件事件 (socket 的可读可写事件) 与时间事件 (定时任务) 两大类。 2 者都会被封装到 aeEventLoop:

```C
typedef struct aeEventLoop {

    /** 事件循环是否结束 */
    int stop; 

    /** 文件事件数组，存储已经注册的文件事件 */
    aeFileEvent *events; 

    /** 存储被触发的文件事件, Redis 有多个定时任务，因此理论上应该有多个时间事件，多个时间事件形成链表 */
    aeFiredEvent *fired; 
    
    /** 为时间事件链表头节点 */
    aeTimeEvent *timeEventHead; 

    /** Redis 服务器需要阻塞等待文件事件的发生，进程阻塞之前会调用 beforesleep 函数，进程因为某种原因被唤醒之后会调用 aftersleep 函数 */
    void *apidata;
    
    aeBeforeSleepProc *beforesleep; 
    aeBeforeSleepProc *aftersleep;

} aeEventLoop;
```

