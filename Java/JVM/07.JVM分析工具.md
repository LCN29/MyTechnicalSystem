# 07. JVM 分析工具

在 $JAVA_HOME/bin 的目录下, 存在着许多小工具, 除了编译和运行Java程序外, 打包, 部署, 签名, 调试, 监控, 运维等 ]各种场景都可能会用到它们。

## 7.1 jps (JVM Process Status Tool) - 虚拟机进程状况工具
列出正在运行的虚拟机进程, 并显示虚拟机执行主类 (Main Class, 也就是 main 方法所在的类) 的名称以及这些进程的本地虚拟机唯一 ID (LVMID，Local Virtual Machine Identifier)。

命令格式
```sh
jps [options] [<hostid>]
```

options 列表

| 选项| 作用 |
| :-: | :-: |
| -q | 只输出 LVMID, 省略主类的名称|
| -m | 输出虚拟机进程启动时, 传递给 main 方法的参数|
| -l | 输出主类的全名称, 如果进程执行的是 jar 包, 输出 jar 包路径|
| -v | 输出 JVM 进程启动时的 JVM 参数|
| -V | 输出 LVMID 和主类的类名, 不带任何参数的 jps, 默认就是这个格式|

jps 还可以通过 RMI 协议查询开启了 RMI 服务的远程虚拟机进程状态, 参数 hostId 为 RMI 注册表中注册的主机名。开启 RMI 的步骤, 可以看[这里](https://blog.csdn.net/qq1169091731/article/details/83067108)。

## 7.2 jstat (JVM Statistics Monitoring Tool) - 虚拟机统计信息监视工具

用于监视虚拟机各种运行状态信息的命令行工具。它可以显示本地或者远程虚拟机进程中的类加载, 内存, 垃圾收集, 即时编译等运行时数据。

```sh
jstat -<options> [-t] [-h<lines>] <vmid> [<interval> [<count>]]
```

options 列表

| 选项| 作用 |
| :-: | :-: |
| -class | 监视类加载/卸载数量, 总空间和类装载消耗时间|
| -gc | 监视堆状况, 包括 Eden 区/ 2 个 Survivor 区/老年代/永久代 等容量, 已用空间, 垃圾收集时间合计等信息 |
| -gccapacity| 监视内容和 -gc 差不多, 但输出内容主要关注的是 Java 堆各个区域的使用到的最大, 最小空间|
| -gcutil| 监视内容和 -gc 差不多, 但输出内容主要关注的是 Java 堆各个区域已使用空间占总空间的百分比|
| -gccause | 和 -gcutil 功能一样, 但是会多输出导致上一次垃圾回收产生的原因|
| -gcnew| 监视新生代垃圾回收情况|
| -gcnewcapacity| 监视内容和 -gcnew 基本一样, 输出主要关注使用到的最大, 最小空间|
| -gcold| 监视老年代垃圾回收情况|
| -gcoldcapacity| 监视内容和 -gcold 基本一样, 输出主要关注使用到的最大, 最小空间|
| -gcpermcapacity| 输出永久代使用到的最大, 最小空间|
| -compiler| 输出即时编译器编译过的方法, 耗时等信息|
| -printcompilation | 输出已经被即时编译的方法|

-t: 用于在最前面输出一个时间戳
-h: 格式 -h数字, 需要搭配后面的循环打印使用, 比如 5, 每个标题头下面输出 5 次结果后, 再次输出标题头, 再 5 次结果
vmid: 如果是本地的话, 就是 LVMID, 如果是远程的服务器的话, 则是类似于这样的格式 **[protocol:][//]lvmid[@hostname[:port]/servername]**
interval: 间隔多少毫秒查询 1 次, 如果为 数字 + s, 则是多少秒查询 1 次
count: 循环查询的次数